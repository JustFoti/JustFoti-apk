# Cloudflare Worker configuration for Flyx Next.js app
# This file is used by @opennextjs/cloudflare for deployment

name = "flyx"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Main entry point (generated by opennextjs-cloudflare)
main = ".open-next/worker.js"

# Assets directory - serve static files
[assets]
directory = ".open-next/assets"

# D1 Database binding for admin operations
[[d1_databases]]
binding = "DB"
database_name = "flyx-admin-db"
database_id = "b7875a59-3876-4223-9c3d-7644c16f44a5"

# Environment variables (set these in Cloudflare Dashboard or via wrangler secret)
# wrangler secret put TMDB_API_KEY
# wrangler secret put JWT_SECRET

[vars]
NODE_ENV = "production"
# Worker URLs - update with your actual subdomain
NEXT_PUBLIC_CF_SYNC_URL = "https://flyx-sync.nickstermagster.workers.dev"
NEXT_PUBLIC_CF_ANALYTICS_WORKER_URL = "https://flyx-analytics.nickstermagster.workers.dev"
NEXT_PUBLIC_CF_PROXY_URL = "https://media-proxy.nickstermagster.workers.dev"

# Observability
[observability]
enabled = true

# Cron trigger for daily metrics aggregation (midnight UTC)
[triggers]
crons = ["0 0 * * *"]

# Production environment
[env.production]
name = "flyx"

[env.production.vars]
NODE_ENV = "production"

[[env.production.d1_databases]]
binding = "DB"
database_name = "flyx-admin-db"
database_id = "b7875a59-3876-4223-9c3d-7644c16f44a5"

# Preview environment (for PR deployments)
[env.preview]
name = "flyx-preview"

[env.preview.vars]
NODE_ENV = "production"

[[env.preview.d1_databases]]
binding = "DB"
database_name = "flyx-admin-db"
database_id = "b7875a59-3876-4223-9c3d-7644c16f44a5"
