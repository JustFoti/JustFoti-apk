# Cloudflare Worker configuration for Flyx Next.js app
# This file is used by @opennextjs/cloudflare for deployment

name = "flyx"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Main entry point (generated by opennextjs-cloudflare)
main = ".open-next/worker.js"

# Assets directory - serve static files
[assets]
directory = ".open-next/assets"

# D1 Database binding for admin operations
[[d1_databases]]
binding = "DB"
database_name = "flyx-admin-db"
database_id = "b7875a59-3876-4223-9c3d-7644c16f44a5"

# =============================================================================
# ENVIRONMENT VARIABLES - SET IN CLOUDFLARE DASHBOARD ONLY!
# =============================================================================
# DO NOT add [vars] section here! It will OVERWRITE dashboard settings on deploy.
# 
# Go to: Cloudflare Dashboard > Workers & Pages > flyx > Settings > Variables
# 
# Required variables (set as Plaintext):
#   NODE_ENV = "production"
#   NEXT_PUBLIC_CF_SYNC_URL = "https://flyx-sync.vynx.workers.dev"
#   NEXT_PUBLIC_CF_ANALYTICS_WORKER_URL = "https://flyx-analytics.vynx.workers.dev"
#   NEXT_PUBLIC_CF_PROXY_URL = "https://media-proxy.vynx.workers.dev"
#   NEXT_PUBLIC_CF_STREAM_PROXY_URL = "https://media-proxy.vynx.workers.dev/stream"
#   NEXT_PUBLIC_CF_TV_PROXY_URL = "https://media-proxy.vynx.workers.dev"
#   NEXT_PUBLIC_CF_TMDB_URL = "https://media-proxy.vynx.workers.dev"
#
# Required secrets (set as Secret/Encrypted):
#   TMDB_API_KEY = your TMDB bearer token
#   JWT_SECRET = your JWT secret
#   RPI_PROXY_KEY = your RPI proxy key
# =============================================================================

# Observability
[observability]
enabled = true

# Cron trigger for daily metrics aggregation (midnight UTC)
[triggers]
crons = ["0 0 * * *"]

# Production environment
[env.production]
name = "flyx"
# Variables are set in Cloudflare Dashboard - DO NOT add [env.production.vars] here!

[[env.production.d1_databases]]
binding = "DB"
database_name = "flyx-admin-db"
database_id = "b7875a59-3876-4223-9c3d-7644c16f44a5"

# Preview environment (for PR deployments)
[env.preview]
name = "flyx-preview"
# Variables are set in Cloudflare Dashboard - DO NOT add [env.preview.vars] here!

[[env.preview.d1_databases]]
binding = "DB"
database_name = "flyx-admin-db"
database_id = "b7875a59-3876-4223-9c3d-7644c16f44a5"
